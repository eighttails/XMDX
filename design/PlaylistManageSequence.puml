@startuml
hide footbox
title プレイリスト管理シーケンス
autonumber

box "Android Activity" #LightBlue
  participant QMLGUI
  participant RootContext
  participant PlaylistManagerClientProxy
  participant PlaylistManagerReplica
end box
box "Android Server" #LightGreen
  participant PlaylistManagerServiceProxy
  participant PlaylistManager
  participant PlayerService
end box

’クライアント側
activate QMLGUI
QMLGUI->PlaylistManagerClientProxy:addFolderDialog()
activate PlaylistManagerClientProxy
PlaylistManagerClientProxy-->PlaylistManagerReplica:addFolder()
activate PlaylistManagerReplica
PlaylistManagerClientProxy-->QMLGUI
deactivate PlaylistManagerClientProxy
QMLGUI->QMLGUI:BusyIndicator表示
activate QMLGUI
deactivate QMLGUI
deactivate QMLGUI

’サービス側
PlaylistManagerReplica->PlaylistManagerServiceProxy:addFolder()
deactivate PlaylistManagerReplica

activate PlaylistManagerServiceProxy
PlaylistManagerServiceProxy->PlaylistManager:addFolder()
loop
activate PlaylistManager
PlaylistManager->PlaylistManager:addFile
activate PlaylistManager
PlaylistManager-->PlayerService:notify("プレイリストに追加中：曲名")
deactivate PlaylistManager
end loop
PlaylistManager-->PlayerService:notify("")
note right:通知を消す

PlaylistManager->PlaylistManagerServiceProxy:<<SIGNAL>>\nplaylistChanged(playList)
note right:シリアライズ化されたプレイリストを文字列として送る\n(QObjectの状態ではプロセス境界をまたげないため)

deactivate PlaylistManager
PlaylistManagerServiceProxy->PlaylistManagerReplica:<<SIGNAL>>\nplaylistChanged(playList)
deactivate PlaylistManagerServiceProxy

’クライアント側
activate PlaylistManagerReplica
PlaylistManagerReplica->PlaylistManagerClientProxy:<<SLOT>>\nsetPlayList(playList)
deactivate PlaylistManagerReplica
activate PlaylistManagerClientProxy
PlaylistManagerClientProxy->RootContext:setContextProperty\n("playlist",playList)
deactivate PlaylistManagerClientProxy
activate RootContext
RootContext->QMLGUI:プレイリスト表示に反映
deactivate RootContext
activate QMLGUI
QMLGUI->QMLGUI:BusyIndicatorを消す
activate QMLGUI
deactivate QMLGUI
deactivate QMLGUI

@enduml
